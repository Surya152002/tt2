<!DOCTYPE html>
<html>
<head>
  <title>Beta Sensor Value</title>
  <style>
    #sensorCanvas {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="statusIndicator"></div>
  <canvas id="sensorCanvas"></canvas>

  <script>
    const canvas = document.getElementById("sensorCanvas");
    const ctx = canvas.getContext("2d");
    ctx.font = "15px Arial";

    let startTime = 0;
    let endTime = 0;
    let prevBeta = 0;
    let hasProperSeating = false;
    let eventListenerAdded = false;

    // WebSocket connection to the server
    const ws = new WebSocket("ws://192.168.0.12:3000"); // Replace with your laptop's IP address

    // Function to update the status indicator
    function updateStatusIndicator(connected) {
      const statusIndicator = document.getElementById("statusIndicator");
      if (connected) {
        statusIndicator.textContent = "Connected to Server";
        statusIndicator.style.color = "green";
      } else {
        statusIndicator.textContent = "Not Connected to Server";
        statusIndicator.style.color = "red";
      }
    }

    // Function to update the canvas with the sensor data
    function updateCanvas(beta) {
      // Clear the canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Round the beta value to the nearest integer
      const roundedBeta = Math.round(beta);

      // ... (Rest of your canvas update code)

      // Send the sensor value to the server
      ws.send(JSON.stringify({ sensorValue: beta }));
    }

    // Function to start the event listeners
    function startEventListeners() {
      window.addEventListener("deviceorientation", deviceOrientationHandler);
      eventListenerAdded = true;
    }

    // Event listener for device orientation change
    function deviceOrientationHandler(event) {
      // Get the beta value from the sensor data
      const beta = event.beta;

      // Update the canvas with the beta value
      updateCanvas(beta);
    }

    // Ensure event listeners are started once the page is loaded
    window.addEventListener("load", () => {
      if (!eventListenerAdded) {
        startEventListeners();
      }
    });

    // WebSocket event handlers
    ws.addEventListener("open", () => {
      // Connection to the server is open
      updateStatusIndicator(true);
    });

    ws.addEventListener("close", () => {
      // Connection to the server is closed
      updateStatusIndicator(false);
    });

    ws.addEventListener("message", (event) => {
      try {
        const data = JSON.parse(event.data);
        if (data.sensorValue !== undefined) {
          // Update the canvas with the sensor value received from the server
          updateCanvas(data.sensorValue);
        }
      } catch (error) {
        console.error("Error parsing message:", error);
      }
    });
  </script>
</body>
</html>
